# risk-hub Architektur

## ğŸ“ Repository-Struktur

```
risk-hub/
â”œâ”€â”€ ğŸ“„ README.md                    # Projekt-Dokumentation
â”œâ”€â”€ ğŸ“„ pyproject.toml               # Python Dependencies (uv/pip)
â”œâ”€â”€ ğŸ“„ docker-compose.yml           # Local Development
â”œâ”€â”€ ğŸ“„ Makefile                     # Dev Commands
â”œâ”€â”€ ğŸ“„ .env.example                 # Environment Template
â”œâ”€â”€ ğŸ“„ .gitignore                   # Git Ignore Rules
â”‚
â”œâ”€â”€ ğŸ“ src/                         # Django Application
â”‚   â”œâ”€â”€ ğŸ“„ manage.py                # Django CLI
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ config/                  # Django Configuration
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py          # Celery App Loading
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ settings.py          # Settings (Pydantic-based)
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ urls.py              # URL Routing
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ api.py               # Django Ninja API
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ celery.py            # Celery Configuration
â”‚   â”‚   â””â”€â”€ ğŸ“„ wsgi.py              # WSGI Entry Point
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ apps/                    # Django Apps (Bounded Contexts)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ core/                # â•â•â• SHARED UTILITIES â•â•â•
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ models.py        # Base Models (TenantModel, TimestampedModel)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ middleware.py    # Request Context, Tenant Resolution
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ request_context.py # Thread-safe Context (tenant_id, user_id)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ views.py         # Health Check
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ logging.py       # JSON Logging
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ context_processors.py # Template Context
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ tenancy/             # â•â•â• MULTI-TENANCY â•â•â•
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ models.py        # Organization, Site
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ admin.py         # Django Admin
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ management/commands/
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ seed_demo.py # Demo Tenant erstellen
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ identity/            # â•â•â• USER MANAGEMENT â•â•â•
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ models.py        # Custom User Model
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ admin.py         # User Admin
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ permissions/         # â•â•â• RBAC + SCOPES â•â•â•
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ models.py        # Permission, Role, Scope, Assignment
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ services.py      # authorize(), has_permission()
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ admin.py         # Permissions Admin
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ audit/               # â•â•â• AUDIT TRAIL â•â•â•
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ models.py        # AuditEvent
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ services.py      # emit_audit_event()
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ admin.py         # Audit Log Viewer
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ outbox/              # â•â•â• EVENT OUTBOX â•â•â•
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ models.py        # OutboxMessage
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ services.py      # publish_event()
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ tasks.py         # Celery Publisher Task
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ risk/                # â•â•â• DOMAIN: RISK â•â•â•
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ models.py        # Assessment, Hazard, Control
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ services.py      # create_assessment(), approve_assessment()
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ views.py         # HTMX Views
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ urls.py          # URL Routing
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ templates/risk/  # Templates
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ actions/             # â•â•â• DOMAIN: MASSNAHMEN â•â•â•
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ models.py        # ActionItem, ActionComment
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ services.py      # create_action(), close_action()
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ views.py         # Views
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ urls.py          # URL Routing
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ documents/           # â•â•â• DOMAIN: DOKUMENTE â•â•â•
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ models.py        # Document, DocumentVersion
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ services.py      # upload_document(), create_version()
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ views.py         # Views
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ urls.py          # URL Routing
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ s3.py            # S3 Client Helper
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ reporting/           # â•â•â• DOMAIN: EXPORTS â•â•â•
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ models.py        # ExportJob, RetentionPolicy
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ services.py      # create_export_job()
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ generators/      # PDF/Excel Generators
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ tasks.py         # Async Export Tasks
â”‚   â”‚       â””â”€â”€ ğŸ“„ urls.py          # URL Routing
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ templates/               # Shared Templates
â”‚       â”œâ”€â”€ ğŸ“„ base.html            # Base Layout
â”‚       â””â”€â”€ ğŸ“ components/          # Reusable Components
â”‚
â”œâ”€â”€ ğŸ“ tests/                       # Test Suite
â”‚   â”œâ”€â”€ ğŸ“ unit/                    # Unit Tests
â”‚   â”œâ”€â”€ ğŸ“ integration/             # Integration Tests
â”‚   â””â”€â”€ ğŸ“ e2e/                     # End-to-End Tests
â”‚
â”œâ”€â”€ ğŸ“ infra/                       # Infrastructure as Code
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ terraform/               # Hetzner Cloud Provisioning
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ main.tf              # Main Configuration
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ variables.tf         # Input Variables
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ outputs.tf           # Output Values
â”‚   â”‚   â””â”€â”€ ğŸ“ environments/
â”‚   â”‚       â”œâ”€â”€ ğŸ“ dev/             # Development
â”‚   â”‚       â”œâ”€â”€ ğŸ“ staging/         # Staging
â”‚   â”‚       â””â”€â”€ ğŸ“ prod/            # Production
â”‚   â”‚           â””â”€â”€ ğŸ“„ prod.tfvars  # Production Variables
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ ansible/                 # Server Configuration
â”‚   â”‚   â”œâ”€â”€ ğŸ“ inventory/           # Server Inventory
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ dev              # Development Hosts
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ staging          # Staging Hosts
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ prod             # Production Hosts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ playbooks/           # Ansible Playbooks
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ site.yml         # Full Site Deployment
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ deploy.yml       # App Deployment Only
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ backup.yml       # Backup Operations
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ roles/               # Ansible Roles
â”‚   â”‚       â”œâ”€â”€ ğŸ“ common/          # Base Server Setup
â”‚   â”‚       â”œâ”€â”€ ğŸ“ docker/          # Docker Installation
â”‚   â”‚       â”œâ”€â”€ ğŸ“ postgres/        # PostgreSQL + PgBouncer
â”‚   â”‚       â”œâ”€â”€ ğŸ“ redis/           # Redis Setup
â”‚   â”‚       â”œâ”€â”€ ğŸ“ app/             # Django App Deployment
â”‚   â”‚       â”œâ”€â”€ ğŸ“ worker/          # Celery Worker
â”‚   â”‚       â””â”€â”€ ğŸ“ nginx/           # Nginx Reverse Proxy
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ docker/                  # Docker Configurations
â”‚       â”œâ”€â”€ ğŸ“ app/
â”‚       â”‚   â””â”€â”€ ğŸ“„ Dockerfile       # Multi-stage Django Build
â”‚       â”œâ”€â”€ ğŸ“ nginx/
â”‚       â”‚   â””â”€â”€ ğŸ“„ nginx.dev.conf   # Nginx Dev Config
â”‚       â””â”€â”€ ğŸ“ postgres/
â”‚           â””â”€â”€ ğŸ“„ init.sql         # Database Initialization
â”‚
â”œâ”€â”€ ğŸ“ scripts/                     # Utility Scripts
â”‚   â”œâ”€â”€ ğŸ“„ deploy.sh                # Deployment Script
â”‚   â”œâ”€â”€ ğŸ“„ backup.sh                # Backup Script
â”‚   â””â”€â”€ ğŸ“„ generate_inventory.py    # Terraform â†’ Ansible Inventory
â”‚
â””â”€â”€ ğŸ“ docs/                        # Documentation
    â”œâ”€â”€ ğŸ“ architecture/            # Architecture Docs
    â”œâ”€â”€ ğŸ“ api/                     # API Documentation
    â””â”€â”€ ğŸ“ deployment/              # Deployment Guides
```

---

## ğŸ›ï¸ Architektur-Ãœbersicht

### Bounded Contexts (Module)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              risk-hub                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         CORE MODULES                                  â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚   tenancy   â”‚  â”‚  identity   â”‚  â”‚ permissions â”‚  â”‚   audit    â”‚  â”‚   â”‚
â”‚  â”‚   â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚            â”‚  â”‚   â”‚
â”‚  â”‚   â”‚ â€¢ Org       â”‚  â”‚ â€¢ User      â”‚  â”‚ â€¢ Role      â”‚  â”‚ â€¢ Event    â”‚  â”‚   â”‚
â”‚  â”‚   â”‚ â€¢ Site      â”‚  â”‚ â€¢ Profile   â”‚  â”‚ â€¢ Scope     â”‚  â”‚ â€¢ Trail    â”‚  â”‚   â”‚
â”‚  â”‚   â”‚ â€¢ Tenant    â”‚  â”‚ â€¢ Auth      â”‚  â”‚ â€¢ Assignmentâ”‚  â”‚            â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚   â”‚
â”‚  â”‚   â”‚   outbox    â”‚  â”‚    core     â”‚                                    â”‚   â”‚
â”‚  â”‚   â”‚             â”‚  â”‚             â”‚                                    â”‚   â”‚
â”‚  â”‚   â”‚ â€¢ Events    â”‚  â”‚ â€¢ Context   â”‚                                    â”‚   â”‚
â”‚  â”‚   â”‚ â€¢ Publisher â”‚  â”‚ â€¢ Middlewareâ”‚                                    â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        DOMAIN MODULES                                 â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚    risk     â”‚  â”‚   actions   â”‚  â”‚  documents  â”‚  â”‚ reporting  â”‚  â”‚   â”‚
â”‚  â”‚   â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚            â”‚  â”‚   â”‚
â”‚  â”‚   â”‚ â€¢ Assessmentâ”‚  â”‚ â€¢ Action    â”‚  â”‚ â€¢ Document  â”‚  â”‚ â€¢ ExportJobâ”‚  â”‚   â”‚
â”‚  â”‚   â”‚ â€¢ Hazard    â”‚  â”‚ â€¢ Task      â”‚  â”‚ â€¢ Version   â”‚  â”‚ â€¢ PDF Gen  â”‚  â”‚   â”‚
â”‚  â”‚   â”‚ â€¢ Control   â”‚  â”‚ â€¢ Escalationâ”‚  â”‚ â€¢ S3 Upload â”‚  â”‚ â€¢ Excel Genâ”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Datenfluss

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser â”‚â”€â”€â”€â”€â–¶â”‚   Nginx     â”‚â”€â”€â”€â”€â–¶â”‚   Django    â”‚â”€â”€â”€â”€â–¶â”‚  Postgres   â”‚
â”‚  HTMX   â”‚â—€â”€â”€â”€â”€â”‚ (Subdomain) â”‚â—€â”€â”€â”€â”€â”‚  (App)      â”‚â—€â”€â”€â”€â”€â”‚  (+ RLS)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   Celery    â”‚
                                    â”‚  (Worker)   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â–¼                   â–¼                   â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Redis     â”‚     â”‚  MinIO/S3   â”‚     â”‚   Email     â”‚
                â”‚  (Queue)    â”‚     â”‚  (Docs)     â”‚     â”‚  (SMTP)     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” RBAC + Scope System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Permission System                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  Permission                    Role                      Scope        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€                      â”€â”€â”€â”€â”€        â”‚
â”‚  risk.assessment.read    â—€â”€â”€â”€  EHS Manager     â”€â”€â”€â–¶  TENANT (all)    â”‚
â”‚  risk.assessment.write         (has 15 perms)         or              â”‚
â”‚  risk.assessment.approve                              SITE (Berlin)   â”‚
â”‚  actions.action.read                                  or              â”‚
â”‚  actions.action.write                                 ASSET (Anlage1) â”‚
â”‚  documents.document.read                                              â”‚
â”‚  ...                                                                  â”‚
â”‚                                                                       â”‚
â”‚  Assignment: User â”€â”€â–¶ Role â”€â”€â–¶ Scope                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                               â”‚
â”‚  Max Mustermann â”€â”€â–¶ "Site Safety Officer" â”€â”€â–¶ Site: Berlin           â”‚
â”‚  Anna Schmidt   â”€â”€â–¶ "EHS Manager"         â”€â”€â–¶ Tenant: Alle Sites     â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Datenbank-Schema (Vereinfacht)

```sql
-- TENANCY
tenancy_organization (id, tenant_id, slug, name, ...)
tenancy_site (id, tenant_id, organization_id, name, code, ...)

-- IDENTITY
identity_user (id, tenant_id, username, email, ...)

-- PERMISSIONS
permissions_permission (id, code, name, module)
permissions_role (id, tenant_id, name, is_system)
permissions_role_permission (role_id, permission_id)
permissions_scope (id, tenant_id, scope_type, site_id, asset_id)
permissions_assignment (id, tenant_id, user_id, role_id, scope_id)

-- AUDIT
audit_event (id, tenant_id, actor_user_id, category, action, 
             entity_type, entity_id, payload, created_at)

-- OUTBOX
outbox_message (id, tenant_id, topic, payload, published_at, created_at)

-- RISK (Domain)
risk_assessment (id, tenant_id, site_id, title, status, ...)
risk_hazard (id, tenant_id, assessment_id, description, ...)
risk_control (id, tenant_id, hazard_id, measure, ...)

-- ACTIONS (Domain)
actions_action (id, tenant_id, title, status, due_date, assignee_id, ...)

-- DOCUMENTS (Domain)
documents_document (id, tenant_id, title, category, ...)
documents_version (id, tenant_id, document_id, version, s3_key, sha256, ...)

-- REPORTING (Domain)
reporting_export_job (id, tenant_id, type, status, params, output_doc_id, ...)
reporting_retention_policy (id, name, years, legal_hold_allowed, ...)
```

---

## ğŸš€ Deployment-Architektur (Hetzner)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Hetzner Cloud                                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        Cloud Network (10.0.0.0/16)                      â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚                    Public Subnet (LB)                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   â”‚              Hetzner Load Balancer                       â”‚   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   â”‚                   (lb11, â‚¬5/mo)                          â”‚   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   â”‚                                                          â”‚   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   â”‚  *.risk-hub.de â”€â”€â–¶ HTTPS (443) â”€â”€â–¶ App Servers (8000)   â”‚   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                              â”‚                                   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                 â”‚                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚              App Subnet (10.0.1.0/24)                             â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                              â”‚                                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   â”‚                                                       â”‚       â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   â–¼                                                       â–¼       â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  App-1      â”‚  â”‚  App-2      â”‚  â”‚       Worker            â”‚  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ cpx31 (â‚¬25) â”‚  â”‚ cpx31 (â‚¬25) â”‚  â”‚     cpx21 (â‚¬15)         â”‚  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚                         â”‚  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Django    â”‚  â”‚ â€¢ Django    â”‚  â”‚ â€¢ Celery Worker         â”‚  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Gunicorn  â”‚  â”‚ â€¢ Gunicorn  â”‚  â”‚ â€¢ Celery Beat           â”‚  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ 10.0.1.10   â”‚  â”‚ 10.0.1.11   â”‚  â”‚ 10.0.1.50               â”‚  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                 â”‚                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚              DB Subnet (10.0.2.0/24)                              â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                              â”‚                                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                              â–¼                                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                    Database Server                          â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                    cpx41 (â‚¬40/mo)                           â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                             â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Postgres  â”‚  â”‚ PgBouncer â”‚  â”‚        Redis          â”‚  â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  :5432    â”‚  â”‚  :6432    â”‚  â”‚        :6379          â”‚  â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                             â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  10.0.2.10  +  50GB Volume (DB Data)                       â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                                  â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      External Services                                   â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚ Object Storage   â”‚  â”‚  Backup Storage  â”‚  â”‚   DNS (Cloudflare)     â”‚ â”‚â”‚
â”‚  â”‚  â”‚ (Documents)      â”‚  â”‚  (wal-g/restic)  â”‚  â”‚                        â”‚ â”‚â”‚
â”‚  â”‚  â”‚ â‚¬5-20/mo         â”‚  â”‚  â‚¬5/mo           â”‚  â”‚   *.risk-hub.de        â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  GeschÃ¤tzte Kosten: ~â‚¬120-150/Monat                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Key Design Decisions

| Aspekt | Entscheidung | BegrÃ¼ndung |
|--------|--------------|------------|
| **Framework** | Django + HTMX | Schnelle Entwicklung, gute Ecosystem, HTMX fÃ¼r reaktive UIs ohne SPA |
| **Multi-Tenancy** | Subdomain + RLS | Saubere Tenant-Isolation, RLS als Defense-in-Depth |
| **Auth/Permissions** | RBAC + Scopes | Enterprise-tauglich, auditierbar, erweiterbar auf ABAC |
| **Background Jobs** | Celery + Redis | BewÃ¤hrt, gut skalierbar, Redis auch fÃ¼r Caching |
| **Documents** | S3-kompatibel | MinIO dev, Hetzner Object Storage prod, spÃ¤ter AWS S3 |
| **Database** | Postgres 16 | Best-in-class, RLS, JSONB, Constraints |
| **IaC** | Terraform + Ansible | Terraform fÃ¼r Infrastruktur, Ansible fÃ¼r Konfiguration |
| **Hosting** | Hetzner | Kosten-effizient, DSGVO-konform, gute API |
