{% load tenancy_components %}
<div class="bg-white border border-gray-200 rounded-lg p-4 flex flex-col gap-3"
     id="module-sub-{{ sub.module }}">
    <div class="flex items-start justify-between">
        <div class="flex items-center gap-3">
            {% if meta.color == "orange" %}
            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <i data-lucide="{{ meta.icon }}" class="w-5 h-5 text-orange-600"></i>
            </div>
            {% elif meta.color == "blue" %}
            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <i data-lucide="{{ meta.icon }}" class="w-5 h-5 text-blue-600"></i>
            </div>
            {% elif meta.color == "red" %}
            <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <i data-lucide="{{ meta.icon }}" class="w-5 h-5 text-red-600"></i>
            </div>
            {% elif meta.color == "purple" %}
            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <i data-lucide="{{ meta.icon }}" class="w-5 h-5 text-purple-600"></i>
            </div>
            {% else %}
            <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <i data-lucide="{{ meta.icon }}" class="w-5 h-5 text-gray-600"></i>
            </div>
            {% endif %}
            <div>
                <div class="font-medium text-gray-900 text-sm">{{ meta.label }}</div>
                <div class="text-xs text-gray-400">{{ sub.plan_code }}</div>
            </div>
        </div>
        <div>
            {% if sub.status == "active" %}
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Aktiv</span>
            {% elif sub.status == "trial" %}
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Trial</span>
            {% else %}
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">Gesperrt</span>
            {% endif %}
        </div>
    </div>

    {% if sub.trial_ends_at or sub.expires_at %}
    <div class="text-xs text-gray-500 space-y-0.5">
        {% if sub.trial_ends_at %}
        <div>Trial bis: <span class="font-medium">{{ sub.trial_ends_at|date:"d.m.Y" }}</span></div>
        {% endif %}
        {% if sub.expires_at %}
        <div>LÃ¤uft ab: <span class="font-medium">{{ sub.expires_at|date:"d.m.Y" }}</span></div>
        {% endif %}
    </div>
    {% endif %}

    <div class="flex items-center gap-2 pt-1 border-t border-gray-100">
        <a href="{% url 'tenancy:module-membership-manage' org.pk sub.module %}"
           class="flex-1 text-center text-xs px-2 py-1.5 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-md font-medium">
            <i data-lucide="users" class="w-3 h-3 inline mr-1"></i>Benutzer
        </a>
        <a href="{% url 'tenancy:module-subscription-edit' org.pk sub.module %}"
           class="flex-1 text-center text-xs px-2 py-1.5 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-md font-medium">
            <i data-lucide="settings" class="w-3 h-3 inline mr-1"></i>Einstellungen
        </a>
        <form method="post" action="{% url 'tenancy:module-subscription-toggle' org.pk sub.module %}" class="flex-1">
            {% csrf_token %}
            {% if sub.status == "suspended" %}
            <button type="submit" name="action" value="activate"
                    class="w-full text-xs px-2 py-1.5 bg-green-50 hover:bg-green-100 text-green-700 rounded-md font-medium">
                <i data-lucide="play" class="w-3 h-3 inline mr-1"></i>Aktivieren
            </button>
            {% else %}
            <button type="submit" name="action" value="suspend"
                    class="w-full text-xs px-2 py-1.5 bg-amber-50 hover:bg-amber-100 text-amber-700 rounded-md font-medium">
                <i data-lucide="pause" class="w-3 h-3 inline mr-1"></i>Sperren
            </button>
            {% endif %}
        </form>
    </div>
</div>
